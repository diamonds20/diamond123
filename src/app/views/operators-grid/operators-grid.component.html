<div class="container">
  <!-- Header row -->
  <c-row>
    <c-col>
      <div class="d-flex justify-content-between align-items-center">
        <h3>Operators</h3>
        <button cButton color="primary" size="sm" (click)="addModalVisible = true">Add Operator</button>
      </div>
      <div class="mb-2" *ngIf="loggedInCompanyId">
        <span class="fw-bold">Company ID:</span> {{ loggedInCompanyId }}
      </div>
    </c-col>
  </c-row>

  <!-- Table -->
  <div class="table-responsive">
    <table cTable>
      <thead cTableHead>
        <tr>
          <th scope="col">Id</th>
          <th scope="col">Name</th>
          <th scope="col">Phone</th>
          <th scope="col">Username</th>
          <th scope="col">Roles</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let operator of operators" [ngSwitch]="!!operator">
          <ng-container *ngSwitchCase="true">
            <td>{{ operator?.operatorId || 'N/A' }}</td>
            <td>{{ operator?.operatorName || 'N/A' }}</td>
            <td>{{ operator?.contactInfo?.phone || 'N/A' }}</td>
            <td>{{ operator?.credentials?.username || 'N/A' }}</td>
            <td>
              <span *ngIf="operator?.roles; else noRoles">
                <span *ngFor="let role of roles; let i = index">
                  <ng-container *ngIf="operator.roles[role] !== undefined">
                    <label>
                      <input type="checkbox" [checked]="operator.roles[role]" [disabled]="true" />
                      {{ role }}
                    </label>
                    <span *ngIf="i !== roles.length - 1">, </span>
                  </ng-container>
                </span>
              </span>
              <ng-template #noRoles>
                <span>No roles</span>
              </ng-template>
            </td>
            <td>
              <span class="me-2 text-primary edit-icon" (click)="openEditOperatorModal(operator)">
                <i class="bi bi-pencil-square"></i>
              </span>
              <span class="vr"></span>
              <span class="ms-2 text-danger delete-icon" (click)="openDeleteOperatorModal(operator)">
                <i class="bi bi-trash"></i>
              </span>
            </td>
          </ng-container>
          <ng-container *ngSwitchDefault>
            <td colspan="6">
              <p>Loading...</p>
            </td>
          </ng-container>
        </tr>
      </tbody>
    </table>
  </div>

 <!-- Add Operator Modal -->
 <c-modal id="addOperatorModal" [visible]="addModalVisible" (visibleChange)="addModalVisible = $event">
  <c-modal-header>
    <h5 cModalTitle>Add Operator</h5>
  </c-modal-header>
  <c-modal-body>
    <form #newOperatorForm="ngForm">
      <div class="mb-3">
        <label cLabel for="companyId">Company Id</label>
        <input cFormControl type="text" id="companyId" placeholder="Enter operator company Id" name="companyId" ngModel pattern="^[0-9]+$" required>
      </div>
      <div class="mb-3">
        <label cLabel for="name">Name</label>
        <input cFormControl type="text" id="name" placeholder="Enter operator name" name="name" value="name" ngModel pattern="^[a-zA-Z ]+$" required>
      </div>
      <div class="mb-3">
        <label cLabel for="phone">Phone</label>
        <input cFormControl type="text" id="phone" placeholder="Enter operator phone" name="phone" value="phone" ngModel pattern="^[0-9]+$" required>
      </div>
      <div class="mb-3">
        <label cLabel for="username">Username</label>
        <input cFormControl type="text" id="username" placeholder="Enter operator username" name="username" value="username" ngModel pattern="^[a-zA-Z0-9]+$" required>
      </div>
      <div class="mb-3">
        <label cLabel for="password">Password</label>
        <input cFormControl type="text" id="password" placeholder="Enter operator password" name="password" value="password" ngModel pattern="^[a-zA-Z0-9]+$" required>
      </div>
      <div class="mb-3">
        <label cLabel>Role</label>
        <div cFormRadio>
          <input cFormRadioInput type="radio" id="role1" name="role" value="role1" ngModel>
          <label cFormRadioLabel for="role1">Role 1</label>
        </div>
        <div cFormRadio>
          <input cFormRadioInput type="radio" id="role2" name="role" value="role2" ngModel>
          <label cFormRadioLabel for="role2">Role 2</label>
        </div>
        <div cFormRadio>
          <input cFormRadioInput type="radio" id="role3" name="role" value="role3" ngModel>
          <label cFormRadioLabel for="role3">Role 3</label>
        </div>
      </div>
    </form>
  </c-modal-body>
  <c-modal-footer>
    <button cButton color="secondary" (click)="addModalVisible = false">Cancel</button>
    <button cButton color="primary" (click)="addNewOperator(); addModalVisible = false">Add Operator</button>
  </c-modal-footer>
</c-modal>

 <!-- Delete Modal -->
 <c-modal id="confirmModal" [visible]="deleteModalVisible" (visibleChange)="deleteModalVisible = $event">
  <c-modal-header>
    <h5 cModalTitle>Confirm Deletion</h5>
  </c-modal-header>
  <c-modal-body>
    Are you sure you want to delete this operator?
  </c-modal-body>
  <c-modal-footer>
    <button cButton color="secondary" (click)="deleteModalVisible = false">Cancel</button>
    <button cButton color="danger" (click)="operatorToDelete && deleteOperator(operatorToDelete); deleteModalVisible = false">Delete</button>
  </c-modal-footer>
</c-modal>

<!-- Edit Operator Modal -->
<c-modal id="editOperatorModal" [visible]="editModalVisible" (visibleChange)="editModalVisible = $event">
  <c-modal-header>
    <h5 cModalTitle>Edit Operator</h5>
  </c-modal-header>
  <c-modal-body>
    <form #editOperatorForm="ngForm" *ngIf="editedOperator">
      <div class="mb-3">
        <label cLabel for="editId">Id</label>
        <input cFormControl type="text" id="editId" placeholder="Enter operator Id" name="Id" [(ngModel)]="editedOperator.operatorId">
      </div>
      <div class="mb-3">
        <label cLabel for="editName">Name</label>
        <input cFormControl type="text" id="editName" placeholder="Enter operator name" name="name" [(ngModel)]="editedOperator.operatorName">
      </div>
      <div class="mb-3">
        <label cLabel for="editPhone">Phone</label>
        <input cFormControl type="text" id="editPhone" placeholder="Enter operator phone" name="phone" [(ngModel)]="editedOperator.contactInfo.phone">
      </div>
      <div class="mb-3">
        <label cLabel for="editUsername">Username</label>
        <input cFormControl type="text" id="editUsername" placeholder="Enter operator username" name="username" [(ngModel)]="editedOperator.credentials.username">
      </div>
      <!-- <div class="mb-3">
        <label cLabel for="password">Password</label>
        <input cFormControl type="text" id="password" placeholder="Enter operator password" name="password" value="password" ngModel>
      </div> -->
      <div class="mb-3">
        <label cLabel>Role</label>
        <div cFormRadio>
          <input cFormRadioInput type="radio" id="role1" name="role" value="role1" ngModel>
          <label cFormRadioLabel for="role1">Role 1</label>
        </div>
        <div cFormRadio>
          <input cFormRadioInput type="radio" id="role2" name="role" value="role2" ngModel>
          <label cFormRadioLabel for="role2">Role 2</label>
        </div>
        <div cFormRadio>
          <input cFormRadioInput type="radio" id="role3" name="role" value="role3" ngModel>
          <label cFormRadioLabel for="role3">Role 3</label>
        </div>
      </div>
    </form>
  </c-modal-body>
  <c-modal-footer>
    <button cButton color="secondary" (click)="editModalVisible = false">Cancel</button>
    <button cButton color="primary" (click)="editedOperator && editOperator(editedOperator); editModalVisible = false">Save Changes</button>
  </c-modal-footer>
</c-modal>

<!-- No Operators Modal -->
<c-modal id="noOperatorsModal" [visible]="showNoOperatorsModal" (visibleChange)="showNoOperatorsModal = $event">
  <c-modal-header>
    <h5 cModalTitle>No Operators Found</h5>
  </c-modal-header>
  <c-modal-body>
    There are no operators found in the system.
  </c-modal-body>
  <c-modal-footer>
    <button cButton color="primary" (click)="showNoOperatorsModal = false">OK</button>
  </c-modal-footer>
</c-modal>
</div>